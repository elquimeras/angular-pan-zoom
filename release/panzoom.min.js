/*!
 AngularJS pan/zoom v1.0.18
 @license: MIT
 Github: https://github.com/mvindahl/angular-pan-zoom
*/
angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",["$document","PanZoomService",function(o,e){var n,i,t={};return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(a,l){var r,m=l,c=l.find(".pan-element"),s=l.find(".zoom-element"),g=c.get(0),f=s.get(0),u=window.requestAnimationFrame||window.mozRequestAnimationFrame,d=o.find("#PanZoomOverlay");0===d.length?(r=$('<div id="PanZoomOverlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0; display: none;"></div>'),o.find("body").append(r)):r=d;var v=function(o){return Math.pow(a.config.scalePerZoomLevel,o-a.config.neutralZoomLevel)};a.config.disableZoomAnimation=void 0!==a.config.disableZoomAnimation&&a.config.disableZoomAnimation,a.config.zoomLevels=void 0!==a.config.zoomLevels?a.config.zoomLevels:5,a.config.neutralZoomLevel=void 0!==a.config.neutralZoomLevel?a.config.neutralZoomLevel:2,a.config.friction=void 0!==a.config.friction?a.config.friction:10,a.config.haltSpeed=void 0!==a.config.haltSpeed?a.config.haltSpeed:100,a.config.scalePerZoomLevel=void 0!==a.config.scalePerZoomLevel?a.config.scalePerZoomLevel:2,a.config.zoomStepDuration=void 0!==a.config.zoomStepDuration?a.config.zoomStepDuration:.2,a.config.zoomToFitZoomLevelFactor=void 0!==a.config.zoomToFitZoomLevelFactor?a.config.zoomToFitZoomLevelFactor:.95,a.config.zoomButtonIncrement=void 0!==a.config.zoomButtonIncrement?a.config.zoomButtonIncrement:1,a.config.useHardwareAcceleration=void 0!==a.config.useHardwareAcceleration&&a.config.useHardwareAcceleration,a.config.initialZoomLevel=void 0!==a.config.initialZoomLevel?a.config.initialZoomLevel:a.config.neutralZoomLevel,a.config.initialPanX=void 0!==a.config.initialPanX?a.config.initialPanX:0,a.config.initialPanY=a.config.initialPanY||0,a.config.keepInBounds=!!a.config.keepInBounds&&a.config.keepInBounds,a.config.keepInBounds&&0!==a.config.neutralZoomLevel&&console.warn("You have set keepInBounds to true and neutralZoomLevel to "+a.config.neutralZoomLevel+". Be aware that the zoom level cannot below "+a.config.neutralZoomLevel),a.config.keepInBoundsRestoreForce=void 0!==a.config.keepInBoundsRestoreForce?a.config.keepInBoundsRestoreForce:.5,a.config.keepInBoundsDragPullback=void 0!==a.config.keepInBoundsDragPullback?a.config.keepInBoundsDragPullback:.7,a.config.zoomOnDoubleClick=void 0===a.config.zoomOnDoubleClick||a.config.zoomOnDoubleClick,a.config.zoomOnMouseWheel=void 0===a.config.zoomOnMouseWheel||a.config.zoomOnMouseWheel,a.config.panOnClickDrag=void 0===a.config.panOnClickDrag||a.config.panOnClickDrag,a.config.invertMouseWheel=void 0!==a.config.invertMouseWheel&&a.config.invertMouseWheel,a.config.chromeUseTransform=!!a.config.chromeUseTransform&&a.config.chromeUseTransform;var p=function(o){var e=l.width(),n=l.height(),i=o.width,t=o.height,r=function(o){return Math.log(o)/Math.log(a.config.scalePerZoomLevel)+a.config.neutralZoomLevel}(Math.min(e/i,n/t))*a.config.zoomToFitZoomLevelFactor,m=v(r);return{zoomLevel:r,pan:{x:-o.x*m+(e-i*m)/2,y:-o.y*m+(n-t*m)/2}}};a.config.initialZoomToFit?a.base=p(a.config.initialZoomToFit):a.base={zoomLevel:a.config.initialZoomLevel,pan:{x:a.config.initialPanX,y:a.config.initialPanY}},a.model.zoomLevel=a.base.zoomLevel,a.model.isPanning=!1,a.model.pan={x:a.base.pan.x,y:a.base.pan.y},a.previousPosition=void 0,a.dragging=!1,a.panVelocity=void 0,a.zoomAnimation=void 0;var h=function(){if(a.zoomAnimation){a.model.zoomLevel=a.base.zoomLevel+a.zoomAnimation.deltaZoomLevel*a.zoomAnimation.progress;var o=a.zoomAnimation.translationFromZoom(a.model.zoomLevel);if(a.model.pan.x=a.base.pan.x+o.x,a.model.pan.y=a.base.pan.y+o.y,a.config.keepInBounds){var e=b({x:0,y:0}),t=b({x:i,y:n});e.x>0&&(a.model.pan.x=0),e.y>0&&(a.model.pan.y=0),t.x<i&&(a.model.pan.x-=t.x-i),t.y<n&&(a.model.pan.y-=t.y-n)}}else a.model.zoomLevel=a.base.zoomLevel,a.model.pan.x=a.base.pan.x,a.model.pan.y=a.base.pan.y;var l=v(a.model.zoomLevel),r="scale("+l+")";if(-1!==navigator.userAgent.indexOf("Chrome")?a.config.chromeUseTransform?(f.style.transformOrigin="0 0",f.style.transform=r):f.style.zoom=l:(f.style.msTransformOrigin="0 0",f.style.msTransform=r,f.style.transformOrigin="0 0",f.style.transform=r,f.style.webkitTransformOrigin="0 0",f.style.webkitTransform=r),a.config.useHardwareAcceleration){var m="translate3d("+a.model.pan.x+"px, "+a.model.pan.y+"px, 0)";g.style.transform=m,g.style.msTransform=m,g.style.webkitTransform=m,g.style.mozTransform=m}else g.style.left=a.model.pan.x+"px",g.style.top=a.model.pan.y+"px"},y=function(o,e,n){a.zoomAnimation&&(a.base.zoomLevel=a.model.zoomLevel,a.base.pan.x=a.model.pan.x,a.base.pan.y=a.model.pan.y,a.zoomAnimation=void 0);var i=a.config.keepInBounds?a.config.neutralZoomLevel:0;o=Math.max(i,o);var t=(o=Math.min(a.config.zoomLevels-1,o))-a.base.zoomLevel;if(t){n=n||a.config.zoomStepDuration;var l=e||{x:m.width()/2,y:m.height()/2},r=v(a.base.zoomLevel),c=a.base.pan.x,s=a.base.pan.y;a.zoomAnimation={deltaZoomLevel:t,translationFromZoom:function(o){var e=v(o),n=l.x-e/r*(l.x-c),i=l.y-e/r*(l.y-s);return{x:n-c,y:i-s}},duration:n,progress:a.config.disableZoomAnimation?1:0}}},z=function(o){y(a.base.zoomLevel+a.config.zoomButtonIncrement,o)},x=function(o){y(a.base.zoomLevel-a.config.zoomButtonIncrement,o)},b=function(o){var e=o,n=v(a.base.zoomLevel),i=a.base.pan;if(a.zoomAnimation){n=v(a.base.zoomLevel+a.zoomAnimation.deltaZoomLevel*a.zoomAnimation.progress);var t=a.zoomAnimation.translationFromZoom(a.model.zoomLevel);i={x:a.base.pan.x+t.x,y:a.base.pan.y+t.y}}return{x:e.x*n+i.x,y:e.y*n+i.y}},L=!1;h();var k,w,M=new function(){var o=null;return function(){var e,t=jQuery.now(),l=o?(t-o)/1e3:0;if(o=t,a.zoomAnimation&&(a.zoomAnimation.progress+=l/a.zoomAnimation.duration,a.zoomAnimation.progress>=1&&(a.zoomAnimation.progress=1,h(),a.base.zoomLevel=a.model.zoomLevel,a.base.pan.x=a.model.pan.x,a.base.pan.y=a.model.pan.y,a.zoomAnimation=void 0,a.config.modelChangedCallback&&a.config.modelChangedCallback(a.model))),a.panVelocity&&!a.dragging)for(;l>0;){var r=Math.min(.02,l);if(l-=r,a.base.pan.x+=a.panVelocity.x*r,a.panVelocity.x*=1-a.config.friction*r,a.base.pan.y+=a.panVelocity.y*r,a.panVelocity.y*=1-a.config.friction*r,e=a.panVelocity,Math.sqrt(e.x*e.x+e.y*e.y)<a.config.haltSpeed){a.panVelocity=void 0,a.config.modelChangedCallback&&a.config.modelChangedCallback(a.model);break}}if(a.config.keepInBounds&&!a.dragging){var m=b({x:0,y:0}),c=b({x:i,y:n});m.x>0&&(a.base.pan.x-=a.config.keepInBoundsRestoreForce*m.x),m.y>0&&(a.base.pan.y-=a.config.keepInBoundsRestoreForce*m.y),c.x<i&&(a.base.pan.x-=a.config.keepInBoundsRestoreForce*(c.x-i)),c.y<n&&(a.base.pan.y-=a.config.keepInBoundsRestoreForce*(c.y-n))}return h(),u&&!L&&u(M),!L}};u?u(M):jQuery.fx.timer(M),a.$on("$destroy",function(){e.unregisterAPI(a.elementId),L=!0}),a.onDblClick=function(o){if(a.config.zoomOnDoubleClick){var e={x:o.pageX-m.offset().left,y:o.pageY-m.offset().top};z(e)}},a.onTouchStart=function(o){if(o.preventDefault(),1===o.originalEvent.touches.length)o.pageX=o.originalEvent.touches[0].pageX,o.pageY=o.originalEvent.touches[0].pageY,a.onMousedown(o);else{var e=o.originalEvent.touches[0].pageX-o.originalEvent.touches[1].pageX,n=o.originalEvent.touches[0].pageY-o.originalEvent.touches[1].pageY;w={length:e*e+n*n}}},a.onTouchMove=function(o){if(o.preventDefault(),1===o.originalEvent.touches.length)o.pageX=o.originalEvent.touches[0].pageX,o.pageY=o.originalEvent.touches[0].pageY,a.onMousemove(o);else{var e=o.originalEvent.touches[0].pageX-o.originalEvent.touches[1].pageX,n=o.originalEvent.touches[0].pageY-o.originalEvent.touches[1].pageY,i=e*e+n*n,t=i-w.length;if(Math.abs(t)<100)return;var l=o.originalEvent.touches[1].pageX+e/2,r=o.originalEvent.touches[1].pageY+n/2,c={x:l-m.offset().left,y:r-m.offset().top};y(a.base.zoomLevel+1e-4*t,c),w={length:i}}},a.onTouchEnd=function(o){a.onMouseup(o)},a.onMousedown=function(e){return a.config.panOnClickDrag&&(w={x:e.pageX,y:e.pageY},k=jQuery.now(),a.dragging=!0,a.model.isPanning=!1,o.on("mousemove",a.onMousemove),o.on("mouseup",a.onMouseup),o.on("touchend",a.onTouchEnd),o.on("touchmove",a.onTouchMove)),!1};var I=function(o){o.x=o.x||0,o.y=o.y||0,a.base.pan.x+=o.x,a.base.pan.y+=o.y,h()};a.onMousemove=function(o){o.preventDefault(),o.stopPropagation();var e=jQuery.now(),t=(e-k)/1e3;a.hasPanned=!0,k=e;var l={x:o.pageX-w.x,y:o.pageY-w.y};if(a.config.keepInBounds){var m=b({x:0,y:0}),c=b({x:i,y:n});m.x>0&&l.x>0&&(l.x*=Math.min(Math.pow(m.x,-a.config.keepInBoundsDragPullback),1)),m.y>0&&l.y>0&&(l.y*=Math.min(Math.pow(m.y,-a.config.keepInBoundsDragPullback),1)),c.x<i&&l.x<0&&(l.x*=Math.min(Math.pow(i-c.x,-a.config.keepInBoundsDragPullback),1)),c.y<n&&l.y<0&&(l.y*=Math.min(Math.pow(n-c.y,-a.config.keepInBoundsDragPullback),1))}I(l),a.model.isPanning||r.css("display","block"),a.model.isPanning=!0,a.panVelocity={x:l.x/t,y:l.y/t},w={x:o.pageX,y:o.pageY}},a.onMouseup=function(){var e=(jQuery.now()-k)/1e3;if(a.panVelocity){var n=Math.max(0,Math.pow(e+1,-4)-.2);a.panVelocity.x*=n,a.panVelocity.y*=n}a.dragging=!1,a.model.isPanning=!1,o.off("mousemove",a.onMousemove),o.off("mouseup",a.onMouseup),o.off("touchend",a.onTouchEnd),o.off("touchmove",a.onTouchMove),r.css("display","none")},a.onMouseleave=function(){a.onMouseup()},a.onMouseWheel=function(o,e,n,i){if(a.config.zoomOnMouseWheel){if(o.preventDefault(),a.zoomAnimation)return;var t=i/Math.abs(i);a.config.invertMouseWheel&&(t=-t);var l={x:o.originalEvent.pageX-m.offset().left,y:o.originalEvent.pageY-m.offset().top};t<0?z(l):t>0&&x(l)}},t={model:a.model,config:a.config,changeZoomLevel:y,zoomIn:z,zoomOut:x,zoomToFit:function(o){a.base=p(o),h()},getViewPosition:b,getModelPosition:function(o){var e=o,n=v(a.base.zoomLevel),i=a.base.pan;return{x:1/n*(e.x-i.x),y:1/n*(e.y-i.y)}},setPanning:I}}],link:function(o,a,l){o.elementId=l.id,n=a.find(".zoom-element").children().height(),i=a.find(".zoom-element").children().width(),o.elementId&&e.registerAPI(o.elementId,t),a.on("touchstart",function(e){o.onTouchStart(e)})},template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden;cursor:move"><div class="pan-element" style="position:absolute;left:0px;top:0px"><div class="zoom-element" ng-transclude></div></div></div>',replace:!0}}]),angular.module("panzoomwidget",[]).directive("panzoomwidget",["$document","PanZoomService",function(o,e){var n;return{restrict:"E",transclude:!0,compile:function(){return{pre:function(){},post:function(i,t,a){if(!(n=a.panzoomId))throw"Error in setup. You must define attribute panzoom-id on the <panzoomwidget> element in order to link it to the id of the <panzoom> element. Ref: ";e.getAPI(n).then(function(e){i.model=e.model,i.config=e.config;var n=t.find(".zoom-slider-widget"),a=function(o){return function(o){return i.config.zoomLevels-1-o/i.widgetConfig.zoomLevelHeight}(o.pageY-t.find(".zoom-slider").offset().top-i.widgetConfig.zoomLevelHeight/2)};i.getZoomLevels=function(){for(var o=[],e=i.config.zoomLevels-1;e>=0;e--)o.push(e);return o},i.widgetConfig={zoomLevelHeight:10},i.zoomIn=function(){e.zoomIn()},i.zoomOut=function(){e.zoomOut()},i.onClick=function(o){var n=a(o);e.changeZoomLevel(n)},i.onMousedown=function(){!0,o.on("mousemove",i.onMousemove),o.on("mouseup",i.onMouseup)},i.onMousemove=function(o){o.preventDefault();var n=a(o);e.changeZoomLevel(n)},i.onMouseup=function(){!1,o.off("mousemove",i.onMousemove),o.off("mouseup",i.onMouseup)},i.onMouseleave=function(){!1},setInterval(function(){var o;n.css("top",(o=i.model.zoomLevel,(i.config.zoomLevels-o-1)*i.widgetConfig.zoomLevelHeight+"px"))},25)})}}},template:'<div class="panzoomwidget"><div ng-click="zoomIn()" ng-mouseenter="zoomToLevelIfDragging(config.zoomLevels - 1)" class="zoom-button zoom-button-in">+</div><div class="zoom-slider" ng-mousedown="onMousedown()" ng-click="onClick($event)"><div class="zoom-slider-widget" ng-style="{\'height\': widgetConfig.zoomLevelHeight - 2 +\'px\'}"></div><div ng-repeat="zoomLevel in getZoomLevels()"  class="zoom-level zoom-level-{{zoomLevel}}" ng-style="{\'height\': widgetConfig.zoomLevelHeight +\'px\'}"></div></div><div ng-click="zoomOut()" ng-mouseenter="zoomToLevelIfDragging(0)" class="zoom-button zoom-button-out">-</div><div ng-transclude></div></div>',replace:!0}}]),angular.module("panzoom").factory("PanZoomService",["$q",function(o){var e={};return{registerAPI:function(n,i){e[n]||(e[n]=o.defer());var t=e[n];if(t.hasBeenResolved)throw"Internal error: attempt to register a panzoom API but key was already used. Did you declare two <panzoom> directives with the same id?";t.resolve(i),t.hasBeenResolved=!0},unregisterAPI:function(o){delete e[o]},getAPI:function(n){return e[n]||(e[n]=o.defer()),e[n].promise}}}]);
